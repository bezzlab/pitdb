{% extends "layoutTables.html" %}
{% block content %}
  
<div class="navbar-default sidebar" role="navigation">
  <div class="sidebar-nav navbar-collapse">
    <ul class="nav" id="side-menu">
      <li class="sidebar-search">
        <div class="input-group custom-search-form">
          <input type="text" class="form-control" placeholder="Search...">
          <span class="input-group-btn">
            <button class="btn btn-default" type="button">
              <i class="fa fa-search"></i>
            </button>
          </span>
        </div>

      </li>
      <li><a href="#summary"><i class="fa fa-dashboard fa-fw"></i> Summary</a></li>
      <li><a href="#observations"><i class="fa fa-dashboard fa-fw"></i> TGE Observations</a></li>
      <li><a href="#sequences"><i class="fa fa-edit fa-fw"></i> Sequences</a></li>
      <li><a href="#massspec_stats"><i class="fa fa-edit fa-fw"></i> Mass-Spectrometry Data Statistics</a></li>
      <li><a href="#psm"><i class="fa fa-edit fa-fw"></i> PSM</a></li>
      <li><a href="#genomic"><i class="fa fa-wrench fa-fw"></i> Genomic Context</span></a></li>
      <li><a href="#mass_statistics"><i class="fa fa-bar-chart-o fa-fw"></i> Mass-spectrometry Statistics</span></a></li>
      <li><a href="tables.html"><i class="fa fa-table fa-fw"></i>Expression Data Statistics </a></li>
    </ul>
    </div>

    </div>

    <div id="page-wrapper">
        <div class="row">
            <div class="col-lg-12">
                <h1 class="page-header">{{ summary.tge.accession }}</h1>
            </div>
        </div>

        <div class="row">
            <div>
                <div class="panel panel-default" id="summary">
                    <div class="panel-heading">
                        <i class="fa fa-bar-chart-o fa-fw"></i> Summary
                    </div>
                    
                    <div class="panel-body">
                        <div class="row" style="margin-left:5px">
                            <label>TGE ID:</label> {{ summary.tge.id }}</br>
                            <label>TGE Type:</label> {{ summary.tge.tge_class }}</br>
                            <label>Uniprot ID:</label><a href="protein?uniprot={{ summary.tge.uniprot_id }}" target="_blank"> {{ summary.tge.uniprot_id }}</a></br>
                            <label>#Observations:</label> {{ summary.obsCount }}</br>
                            <label>Organisms:</label> 
                            {% for org in summary.organisms %}
                              <a href="organism?organism={{ org }}" target="_blank">{{ org }}</a>,
                            {% endfor %}</br>
                        </div>
                        <!--div class="row">
                            <div id="pie_organism" class="col-xs-6" style="height:350px;"></div>
                            <div id="pie_sample"   class="col-xs-6 pull-right" style="height:350px;"></div>
                        </div>-->
                    </div>
                </div>

                <div class="panel panel-default" id="observations">
                    <div class="panel-heading">
                        <i class="fa fa-bar-chart-o fa-fw"></i> TGE Observations
                    </div>
                    
                    <div class="panel-body">
                        <div class="wordwrap"><label>TGE Sequence:</label> <span id="tgeSeq" value={{ summary.tge.amino_seq }}>{{ summary.tge.amino_seq }}</span></div><br/><br/>

                        <table class="table table-striped table-bordered dataTable no-footer clickable" id="tges" >
                        <thead>
                          <tr>
                            <th>Obs</th>
                            <th>Experiment</th>
                            <th>Sample</th>
                            <th>Organism</th>
                            <th>Type&nbsp;/&nbsp;Strand</th>
                            <th>Identified Peptides</th>
                          </tr>
                        </thead>
                        <tbody>
                          {% for res in results %}
                            <tr>
                              <td>{{ res.observation }}</td>
                              <td>{{ res.experiment }}</td>
                              <td>{{ res.sample }}</td>
                              <td>{{ res.organism }}</td>
                              <td>{{ res.type }}&nbsp;({{ res.strand }})</td>
                              <td class="wordwrap"><strong>Total: {{ res.peptide_num }}</strong><br/>{% for pep in res.peptides %}{{ pep }}, <br/>{% endfor %}</td>
                            </tr>
                          {% endfor %}
                        </tbody>
                      </table>
                    </div>
                </div>


                <div class="panel panel-default" id="massspec_stats">
                    <div class="panel-heading ">
                        <i class="fa fa-bar-chart-o fa-fw"></i> Mass-Spectrometry Data Statistics
                    </div>
                    
                    <div class="panel-body collapse in">
                        <div class="row" style="margin-left:5px">
                            <label>Average peptide coverage:</label> </br>
                            <label>Average peptides per TGE:</label> {{ avgPeptNum }}</br>
                            <label>Average PSM count per peptide:</label>  </br>
                            <label>Score:</label>  </br>
                            <label>Software:</label>  </br>
                        </div>
                    </div>
                </div>

                <div class="panel panel-default" id="mass_statistics">
                    <div class="panel-heading">
                        <i class="fa fa-bar-chart-o fa-fw"></i> Mass-spectrometry Data Statistics
                    </div>
                    
                    <div class="panel-body">
                        <label>Average peptide coverage:</label> <br>
                        <label>Average peptides per TGE:</label> <br/>
                        <label>Average PSM count per peptide:</label> <br/>
                        <label>Score:</label> <br/>
                        <label>Software: </label>
                        <div id="tester" style="width:700px;height:450px;"></div>
                    </div>
                </div>
            
            </div>
        </div>
    </div>
<script src="/static/js/ext/jquery-2.1.4.min.js"></script>
<script src="/static/js/ext/plotly.min.js"></script>
<script src="//d3js.org/d3.v3.min.js"></script>
<script>

var width = 400,
    height = 200,
    radius = Math.min(width, height) / 2;

var color = d3.scale.ordinal()
    .range(["#98abc5", "#8a89a6", "#7b6888", "#6b486b", "#a05d56", "#d0743c", "#ff8c00"]);

var arc = d3.svg.arc()
    .outerRadius(radius - 10)
    .innerRadius(0);

var labelArc = d3.svg.arc()
    .outerRadius(radius - 40)
    .innerRadius(radius - 40);

var pie = d3.layout.pie()
    .sort(null)
    .value(function(d) { return d.count; });

var svg = d3.select("#summary").append("svg")
    .attr("width", width)
    .attr("height", height)
  .append("g")
    .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

d3.json("/tge/{{ summary.tge.accession }}/tge.json", function(error, data) {

  var g = svg.selectAll(".arc")
        .data(pie(data))
        .enter().append("g")
        .attr("class", "arc");

  g.append("path")
        .attr("d", arc)
        .style("fill", function (d) {
        return color(d.data.organism);
    });

  g.append("text")
      .attr("transform", function(d) { return "translate(" + labelArc.centroid(d) + ")"; })
      .attr("dy", ".35em")
      .style("font-size","10px")
      .text(function(d) { return d.data.organism +" "+d.data.count; });
});


</script>


{% endblock %}